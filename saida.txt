# üõ°Ô∏è Sistema de Autentica√ß√£o e Autoriza√ß√£o (RBAC) com FastAPI e DynamoDB Local

## üìñ Vis√£o Geral

Este projeto implementa um **sistema de autentica√ß√£o e controle de acesso baseado em pap√©is (RBAC)** sobre o **DynamoDB Local** usando **FastAPI**.
Ele simula o modelo de permiss√µes de bancos de dados relacionais e servi√ßos em nuvem, permitindo atribuir permiss√µes espec√≠ficas a usu√°rios e pap√©is.

### Funcionalidades

* **Autentica√ß√£o JWT:** Login seguro com gera√ß√£o e valida√ß√£o de tokens.
* **Autoriza√ß√£o Din√¢mica:** Verifica√ß√£o de permiss√µes (`table:action`, ex.: `customer:read`) com base no papel do usu√°rio.
* **Tabelas de Configura√ß√£o:** Gerenciamento seguro das tabelas sens√≠veis `users` e `roles`.
* **Testes Automatizados:** Su√≠te completa (`pytest`) com 37 casos de teste cobrindo toda a matriz de permiss√µes e opera√ß√µes CRUD.

---

## üöÄ Como Executar Localmente

### Pr√©-requisitos

* Docker
* Docker Compose

### 1. Inicializando os Containers

O `docker-compose.yml` cria a API (`auth-api`) e o **DynamoDB Local** com dados iniciais:

```bash
docker compose up --build
```

* Painel Admin: [http://localhost:8001](http://localhost:8001)
* API Swagger: [http://localhost:8080/docs](http://localhost:8080/docs)

|       ![Painel Admin](./imagensReadme/painelAdmin.png)      |
| :---------------------------------------------------------: |
| *Painel Admin com acesso total (CRUDE) em todas as tabelas* |

| ![Swagger UI](./imagensReadme/documentacaoApi.png) |
| :------------------------------------------------: |
|          *Documenta√ß√£o interativa da API*          |

### 2. Acessando Logs da API

```bash
docker logs -f auth-api
```

---

## üîê Usu√°rios e Pap√©is de Teste

| Papel  | Username | Senha       | Permiss√µes em tabelas de dados | Permiss√µes em `users` / `roles` |
| ------ | -------- | ----------- | ------------------------------ | ------------------------------- |
| admin  | admin1   | AdminPass1  | * (total)                      | * (total)                       |
| writer | writer1  | WriterPass1 | read, write, update, delete    | Nenhuma (403 Forbidden)         |
| reader | reader1  | ReaderPass1 | read                           | Nenhuma (403 Forbidden)         |

---

## üß™ Exemplos de Uso

### Entrando no Container da API

```bash
docker exec -it auth-api bash
python3 auth_cli.py
```

Digite as credenciais do usu√°rio para testar permiss√µes.

### Reader - Opera√ß√µes Permitidas / Bloqueadas

**GET (permitido):**

```sql
SELECT * FROM branch WHERE branch_name = 'North Town';
```

**Resposta:**

```json
{'branch_city': 'Rye', 'branch_name': 'North Town', 'assets': 3700000}
```

**POST (proibido):**

```sql
INSERT INTO customer VALUE {'customer_name': 'Bob', 'customer_city': 'London'};
```

**Resposta:**

```
‚ùå ERRO DE AUTORIZA√á√ÉO: O usu√°rio 'reader1' (papel: reader) n√£o possui 'customer:write'.
```

### Writer - CRUDE

**INSERT**

```sql
INSERT INTO customer VALUE {'customer_name': 'Bob', 'customer_city': 'London'};
```

**SELECT**

```sql
SELECT * FROM customer WHERE customer_name = 'Bob';
```

**Resposta:**

```json
{'customer_name': 'Bob', 'customer_city': 'London'}
```

**UPDATE**

```sql
UPDATE customer SET customer_city = 'Paris' WHERE customer_name = 'Bob';
```

**DELETE**

```sql
DELETE FROM customer WHERE customer_name = 'Bob';
```

---

### Acesso √†s Tabelas Sens√≠veis (`users` / `roles`)

* **Reader / Writer:** ‚ùå n√£o autorizado
* **Admin:** ‚úî acesso total (`*`)

---

## üß™ Testes Automatizados (Pytest)

Executar todos os testes de integra√ß√£o:

```bash
docker exec auth-api sh -c "python -m pytest /app/test_auth.py"
```

**Sa√≠da Esperada:**

```
============================= test session starts ==============================
collected 37 items
test_auth.py ..................................... [100%]
============================== 37 passed in 8.64s ============================
```

Os testes validam:

* Permiss√µes CRUD em tabelas de dados
* Restri√ß√µes de acesso em `users` e `roles`
* Autentica√ß√£o inv√°lida

---

## üìö Estrutura do Projeto

```
.
‚îú‚îÄ‚îÄ authModule/           # C√≥digo da API FastAPI
‚îú‚îÄ‚îÄ dbdata/               # Dados persistentes do DynamoDB Local
‚îú‚îÄ‚îÄ init/                 # Scripts de inicializa√ß√£o e dados iniciais
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ test_auth.py          # Testes de integra√ß√£o
‚îú‚îÄ‚îÄ README.md
‚îî‚îÄ‚îÄ LICENSE
```

---

## üîë Conclus√£o

Este projeto demonstra como implementar autentica√ß√£o e autoriza√ß√£o robusta em um ambiente **NoSQL local**, simulando controles t√≠picos de bancos relacionais e servi√ßos na nuvem.

---

## üìù Licen√ßa

Distribu√≠do sob a **licen√ßa GNU**. Consulte [LICENSE](./LICENSE) para mais detalhes.
